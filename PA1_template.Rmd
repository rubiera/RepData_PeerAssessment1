---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library load, warning=FALSE, message=FALSE}
library(tidyverse)
```

## Loading and preprocessing the data
I load the data into a variable named proj_data, and check the percent of NAs in the steps variable.

```{r data load, warning=FALSE, cache=TRUE}
proj_data <- read_csv("./data/activity.csv")
head(proj_data)
class(proj_data)
mean(is.na(proj_data$steps))
```

The data is in tibble format, which is the format I need to use the various functions available from tidyverse.

```{r data time range, warning=FALSE}
interval_whole <-strptime(str_pad(proj_data$interval,4,pad="0"), format='%M %S')
proj_data_mutated <- mutate(proj_data,date_time = 
                              as.POSIXct(paste(proj_data$date, substr(interval_whole,15,20))))
head(proj_data_mutated)
nrow(proj_data_mutated)
proj_data_mutated_na_removed <- na.omit(proj_data_mutated)
head(proj_data_mutated_na_removed)


```

The percent of NA rows matches the difference in the original data and the data with NA values removed.

```{r data na check, warning=FALSE}
nrow(proj_data_mutated)
nrow(proj_data_mutated_na_removed)
(1-(15264/17568))
```

ggplot automatically removes NAs. Here, I plot the distribution minus NAs, and it's exactly the same as the steps distribution with NAs.

```{r data time plot no na, warning=FALSE}
ggplot(data = proj_data_mutated_na_removed)+geom_path(mapping = aes(x=date_time, y=steps))+
  labs(x="Time", y = "Steps")+
  ggtitle("Steps across time")
```

ggplot automatically removes NAs. Here, I plot the distribution minus NAs, and it's exactly the same as the steps distribution with NAs. 

```{r data-total-daily-steps, warning=FALSE}
proj_data_day_sum <- proj_data %>% group_by(date) %>%
      summarize(Sum.Steps = sum(steps))
ggplot(data = proj_data_day_sum, aes(x = date, y = Sum.Steps))+ 
  geom_bar(stat = "identity")+
  labs(x="Date", y = "Sum of Daily Steps")+
  ggtitle("Total Daily Steps")
```

The mean, excluding NAs, of the total steps per day is 10766.19.

```{r data-mean-daily-steps, warning=FALSE}
mean(na.omit(proj_data_day_sum$Sum.Steps))
```

## What is mean total number of steps taken per day?

Here is the distribution of the mean number of steps taken per day.

```{r data mean, warning=FALSE}
proj_data_mean <- proj_data_mutated_na_removed %>% group_by(date) %>%
                                        summarize(mean = mean(steps))
ggplot(data = proj_data_mean)+geom_col(mapping = aes(x=date, y=mean))+
  labs(x="Time", y = "Mean Daily Steps")+
  ggtitle("Mean Daily Steps")
```

Here is the distribution of the median number of steps taken per day for days with non-zero steps. The median for all days, including days with zero steps is zero for all days.

```{r data median, warning=FALSE}
proj_data_median <- proj_data_mutated_na_removed %>% group_by(date) %>%
  summarize(median = median(steps[steps > 0]))
ggplot(data = proj_data_median)+geom_col(mapping = aes(x=date, y=median))+
  labs(x="Time", y = "Median Daily Steps")+
  ggtitle("Median Daily Steps
          \n (excluding intervals with steps = 0")
```

## What is the average daily activity pattern?

As part of the exploration to answer this question, I have plotted the steps activity daily. 

```{r data daily average, warning=FALSE}
ggplot(data = proj_data_mutated)+
  geom_line(mapping = aes(x = interval, y = steps))+
  facet_wrap(~ date, nrow = 6)
```

Here is the mean number of steps by 5 second interval for all days.

```{r data daily average by time interval, warning=FALSE}
proj_data_interval <- proj_data_mutated_na_removed %>% group_by(interval) %>%
  summarize(mean = mean(steps))
ggplot(data = proj_data_interval)+geom_line(mapping = aes(x=interval, y=mean))+
  labs(x="Time Interval", y = "Mean Daily Steps")+
  ggtitle("Mean Daily Steps by Time Interval
          \n in Seconds for Entire Day")
```

The 5-minute interval that, on average, contains the maximum number of steps is found at 8 minutes and 35 seconds from the beginning of the day. The mean steps for this maximum interval is 206.

```{r max time interval, warning=FALSE}
filter(proj_data_interval, mean == max(mean))
```

## Imputing missing values
## Are there differences in activity patterns between weekdays and weekends?

I will answer the last two questions together. Actually, I want to answer them in the opposite order: I want to know the variations by day of the week and by separating the weekdays from the weekends, and then I want to carry out my imputation.

```{r factors, warning=FALSE}
proj_data_daysofweek <- mutate(proj_data_mutated,
  Day.of.Week = weekdays(as.POSIXct(date)))
Weekday <- c("Monday","Tuesday","Wednesday","Thursday","Friday")
Weekend <- c("Saturday","Sunday")
weekdays_weekend <- list(Weekday, Weekend)
factor(weekdays_weekend, levels = list(Weekday, Weekend))
proj_data_weekdays_only <- filter(proj_data_daysofweek,Day.of.Week %in% weekdays_weekend[[1]])
proj_data_weekdays_only <- mutate(proj_data_weekdays_only, Day.Type = c("Weekday"))
proj_data_weekend_only <- filter(proj_data_daysofweek,Day.of.Week %in% weekdays_weekend[[2]])
proj_data_weekend_only <- mutate(proj_data_weekend_only, Day.Type = c("Weekend"))
proj_data_factors <- rbind(proj_data_weekdays_only, proj_data_weekend_only)
head(proj_data_factors)
```

Intervals by day of the week.

```{r data-weekday-daily-average, warning=FALSE}
ggplot(data = proj_data_factors)+
  geom_line(mapping = aes(x = interval, y = steps))+
  facet_wrap(~ Day.of.Week, nrow = 2)
```

Intervals by if the day is a weekday or a weekend.

```{r data-weekend-daily-average, warning=FALSE}
ggplot(data = proj_data_factors)+
  geom_line(mapping = aes(x = interval, y = steps))+
  facet_wrap(~ Day.Type, nrow = 1)
```
